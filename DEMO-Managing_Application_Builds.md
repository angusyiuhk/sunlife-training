<!-- Copy and paste the converted output. -->



# Managing Application Builds


## Review the application source code


### 1. Preparing your Repo


```
$ git clone https://github.com/<ur own repo>/sunlife-training.git
```



### 2. Inspect the ServerHostEndPoint.java file inside ~/sunlife-training/developer-src/java-serverhost/src/main/java/com/redhat/training/example/ javaserverhost/rest


```
$ cat ~/sunlife-training/developer-src/java-serverhost/src/main/java/com/redhat/training/example/ javaserverhost/rest/ServerHostEndPoint.java
```



```
package com.redhat.training.example.javaserverhost.rest;

import javax.ws.rs.Path;
import javax.ws.rs.core.Response;
import javax.ws.rs.GET;
import javax.ws.rs.Produces;
import java.net.InetAddress;

@Path("/")
public class ServerHostEndPoint {

  @GET
  @Produces("text/plain")
  public Response doGet() {
    String host = "";
    try {
      host = InetAddress.getLocalHost().getHostName();
    }
    catch (Exception e) {
       e.printStackTrace();
    }
    String msg = "I am running on server "+host+" Version 1.0 \n";
    return Response.ok(msg).build();
  }
}
```



## Create a new project


### 1. Login to OCP as developer 


```
$ oc login -u user1 -p 'r3dh4t1!' https://api.cluster-sunlife-2bfb.sunlife-2bfb.sandbox1899.opentlc.com:6443
```



```
The server uses a certificate signed by an unknown authority.
You can bypass the certificate check, but any data you send to the server could be intercepted by others.
Use insecure connections? (y/n): y

Login successful.

You have access to 273 projects, the list has been suppressed. You can list all projects with 'oc projects'

Using project "default".
```



### 2. Create a new project &lt;urname>-manage-builds


```
$ oc new-project sunny-manage-builds
```



```
Now using project "sunny-manage-builds" on server "https://api.cluster-sunlife-2bfb.sunlife-2bfb.sandbox1899.opentlc.com:6443".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app django-psql-example

to build a new example application in Python. Or use kubectl to deploy a simple Kubernetes application:

    kubectl create deployment hello-node --image=gcr.io/hello-minikube-zero-install/hello-node

```



## Create a new application


### 1. Create a new application from sources in Git


```
$ oc new-app --name jhost  --build-env -i redhat-openjdk18-openshift:1.5  https://github.com/<your name>/sunlife-training  --context-dir developer-src/java-serverhost
```



```
...output omitted...
imagestream.image.openshift.io "jhost" created buildconfig.build.openshift.io "jhost" created deploymentconfig.apps.openshift.io "jhost" created service "jhost" created
...output omitted...
```



### 2. Check the build logs from the jhost build 


```
$ oc logs -f bc/jhost
```



```
...output omitted...
Writing manifest to image destination
Storing signatures
...output omitted...
Push successful
```



### 3. Wait for the application to be ready and running


```
$ oc get pod
```



### 4. Expose the application to external access


```
$ oc expose svc/jhost
```



```
route.route.openshift.io/jhost exposed
```



### 5. Get the hostname generated by OpenShift for the new route


```
$ oc get route
```



```
NAME            HOST/PORT 
jhost               jhost-youruser-manage-builds.apps.cluster.domain.example.com 
```



### 6. Test the application


```
$ curl http://<the route>
```



```
I am running on server jhost-1-10mbp Version 1.0 
```



## List build configurations and builds


### 1. List all build configurations in the project by running the oc get bc


```
$ oc get bc
```



### 2. List all builds available in the project


```
$ oc get builds
```



## Update the application to version 2.0


### 1. Edit the ServerHostEndPoint.java file


```
$ vi ~/sunlife-training/developer-src/java-serverhost/src/main/java/com/redhat/training/example/ javaserverhost/rest/ServerHostEndPoint.java


```



```
String msg = "I am running on server "+host+" Version 2.0 \n";
```



### 2. Commit the changes to the Git server.


```
$ git add 
$ git commit -m 'Update the version'
```



### 3. Start a new build with the oc start-build command


```
$ oc start-build bc/jhost 
```



```
build.build.openshift.io/jhost-2 started
```



### 4. Cancel the build to avoid a new deployment using the older version


```
$ oc cancel-build bc/jhost
```



```
build.build.openshift.io/jhost-2 marked for cancellation, waiting to be cancelled build.build.openshift.io/jhost-2 cancelled
```



### 5. Check that the build was canceled


```
$ oc get builds
```



### 6. Push the updated source code to the Git server


```
$ git push
```



### 7. Start a new build to deploy the updated version of the application


```
$ oc start-build bc/jhost
```



```
build.build.openshift.io/jhost-3 started
```



### 8. List all builds


```
$ oc get builds
```



```
build.build.openshift.io/jhost-3 started
```



### 9. Follow the application build logs


```
$ oc logs -f build/jhost-3
```



```
...output omitted...
Push successful
```



### 10. Follow the application build logs


```
$ oc get pods
```



### 11. Test the updated application


```
$ curl http://<the route>
```



```
I am running on server jhost-2-10mbp Version 2.0
```



## Clean up


```
$ oc delete project  <urname>-manage-builds
```


